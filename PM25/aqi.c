#include "config.h"

uint16 const aqi_table_china[501] = 
{
0	,
3 	,
4 	,
6 	,
7 	,
9 	,
10 	,
11 	,
13 	,
14 	,
16 	,
17 	,
19 	,
20 	,
21 	,
23 	,
24 	,
26 	,
27 	,
29 	,
30 	,
31 	,
33 	,
34 	,
36 	,
37 	,
39 	,
40 	,
41 	,
43 	,
44 	,
46 	,
47 	,
49 	,
50	,
51 	,
53 	,
54 	,
55 	,
56 	,
58 	,
59 	,
60 	,
61 	,
63 	,
64 	,
65 	,
66 	,
68 	,
69 	,
70 	,
71 	,
73 	,
74 	,
75 	,
76 	,
78 	,
79 	,
80 	,
81 	,
83 	,
84 	,
85 	,
86 	,
88 	,
89 	,
90 	,
91 	,
93 	,
94 	,
95 	,
96 	,
98 	,
99 	,
100 	,
101 	,
103 	,
104 	,
105 	,
106 	,
108 	,
109 	,
110 	,
111 	,
113 	,
114 	,
115 	,
116 	,
118 	,
119 	,
120 	,
121 	,
123 	,
124 	,
125 	,
126 	,
128 	,
129 	,
130 	,
131 	,
133 	,
134 	,
135 	,
136 	,
138 	,
139 	,
140 	,
141 	,
143 	,
144 	,
145 	,
146 	,
148 	,
149 	,
150 	,
151 	,
153 	,
154 	,
156 	,
157 	,
159 	,
160 	,
161 	,
163 	,
164 	,
166 	,
167 	,
169 	,
170 	,
171 	,
173 	,
174 	,
176 	,
177 	,
179 	,
180 	,
181 	,
183 	,
184 	,
186 	,
187 	,
189 	,
190 	,
191 	,
193 	,
194 	,
196 	,
197 	,
199 	,
200 	,
201	,
202	,
203	,
204	,
205	,
206	,
207	,
208	,
209	,
210	,
211	,
212	,
213	,
214	,
215	,
216	,
217	,
218	,
219	,
220	,
221	,
222	,
223	,
224	,
225	,
226	,
227	,
228	,
229	,
230	,
231	,
232	,
233	,
234	,
235	,
236	,
237	,
238	,
239	,
240	,
241	,
242	,
243	,
244	,
245	,
246	,
247	,
248	,
249	,
250	,
251	,
252	,
253	,
254	,
255	,
256	,
257	,
258	,
259	,
260	,
261	,
262	,
263	,
264	,
265	,
266	,
267	,
268	,
269	,
270	,
271	,
272	,
273	,
274	,
275	,
276	,
277	,
278	,
279	,
280	,
281	,
282	,
283	,
284	,
285	,
286	,
287	,
288	,
289	,
290	,
291	,
292	,
293	,
294	,
295	,
296	,
297	,
298	,
299	,
300	,
300	,
301	,
302	,
303	,
304	,
305	,
306	,
307	,
308	,
309	,
310	,
311	,
312	,
313	,
314	,
315	,
316	,
317	,
318	,
319	,
320	,
321	,
322	,
323	,
324	,
325	,
326	,
327	,
328	,
329	,
330	,
331	,
332	,
333	,
334	,
335	,
336	,
337	,
338	,
339	,
340	,
341	,
342	,
343	,
344	,
345	,
346	,
347	,
348	,
349	,
350	,
351	,
352	,
353	,
354	,
355	,
356	,
357	,
358	,
359	,
360	,
361	,
362	,
363	,
364	,
365	,
366	,
367	,
368	,
369	,
370	,
371	,
372	,
373	,
374	,
375	,
376	,
377	,
378	,
379	,
380	,
381	,
382	,
383	,
384	,
385	,
386	,
387	,
388	,
389	,
390	,
391	,
392	,
393	,
394	,
395	,
396	,
397	,
398	,
399	,
400	,
401	,
402	,
403	,
403	,
404	,
405	,
405	,
406	,
407	,
407	,
408	,
409	,
409	,
410	,
411	,
411	,
412	,
413	,
413	,
414	,
415	,
415	,
416	,
417	,
417	,
418	,
419	,
419	,
420	,
420	,
421	,
422	,
422	,
423	,
424	,
424	,
425	,
426	,
426	,
427	,
428	,
428	,
429	,
430	,
430	,
431	,
432	,
432	,
433	,
434	,
434	,
435	,
436	,
436	,
437	,
438	,
438	,
439	,
440	,
440	,
441	,
442	,
442	,
443	,
444	,
444	,
445	,
446	,
446	,
447	,
448	,
448	,
449	,
450	,
450	,
451	,
452	,
452	,
453	,
454	,
454	,
455	,
455	,
456	,
457	,
457	,
458	,
459	,
459	,
460	,
461	,
461	,
462	,
463	,
463	,
464	,
465	,
465	,
466	,
467	,
467	,
468	,
469	,
469	,
470	,
471	,
471	,
472	,
473	,
473	,
474	,
475	,
475	,
476	,
477	,
477	,
478	,
479	,
479	,
480	,
481	,
481	,
482	,
483	,
483	,
484	,
485	,
485	,
486	,
487	,
487	,
488	,
489	,
489	,
490	,
490	,
491	,
492	,
492	,
493	,
494	,
494	,
495	,
496	,
496	,
497	,
498	,
498	,
499	,
500	
};	

uint16 const aqi_table_usa[501] = 
{
0	,
4	,
8	,
13	,
17	,
21	,
25	,
29	,
33	,
38	,
42	,
46	,
50	,
53	,
55	,
57	,
59	,
61	,
63	,
66	,
68	,
70	,
72	,
74	,
76	,
78	,
80	,
82	,
84	,
87	,
89	,
91	,
93	,
95	,
97	,
99	,
102	,
105	,
107	,
110	,
112	,
115	,
117	,
119	,
122	,
124	,
127	,
129	,
132	,
134	,
137	,
139	,
142	,
144	,
147	,
149	,
151	,
152	,
152	,
153	,
153	,
154	,
154	,
155	,
155	,
156	,
156	,
157	,
157	,
158	,
158	,
159	,
160	,
160	,
161	,
161	,
162	,
162	,
163	,
163	,
164	,
164	,
165	,
165	,
166	,
166	,
167	,
167	,
168	,
168	,
169	,
169	,
170	,
170	,
171	,
171	,
172	,
172	,
173	,
173	,
174	,
174	,
175	,
176	,
176	,
177	,
177	,
178	,
178	,
179	,
179	,
180	,
180	,
181	,
181	,
182	,
182	,
183	,
183	,
184	,
184	,
185	,
185	,
186	,
186	,
187	,
187	,
188	,
188	,
189	,
189	,
190	,
190	,
191	,
192	,
192	,
193	,
193	,
194	,
194	,
195	,
195	,
196	,
196	,
197	,
197	,
198	,
198	,
199	,
199	,
200	,
201	,
202	,
203	,
204	,
205	,
206	,
207	,
208	,
209	,
210	,
211	,
212	,
213	,
214	,
215	,
216	,
217	,
218	,
219	,
220	,
221	,
222	,
223	,
224	,
225	,
226	,
227	,
228	,
229	,
230	,
231	,
232	,
233	,
234	,
235	,
236	,
237	,
238	,
239	,
240	,
241	,
242	,
243	,
244	,
245	,
246	,
247	,
248	,
249	,
250	,
251	,
252	,
253	,
254	,
255	,
256	,
257	,
258	,
259	,
260	,
261	,
262	,
263	,
264	,
265	,
266	,
267	,
268	,
269	,
270	,
271	,
272	,
273	,
274	,
275	,
276	,
277	,
278	,
279	,
280	,
281	,
282	,
283	,
284	,
285	,
286	,
287	,
288	,
289	,
290	,
291	,
292	,
293	,
294	,
295	,
296	,
297	,
298	,
299	,
300	,
301	,
302	,
303	,
304	,
305	,
306	,
307	,
308	,
309	,
310	,
311	,
312	,
313	,
314	,
315	,
316	,
317	,
318	,
319	,
320	,
321	,
322	,
323	,
324	,
325	,
326	,
327	,
328	,
329	,
330	,
331	,
332	,
333	,
334	,
335	,
336	,
337	,
338	,
339	,
340	,
341	,
342	,
343	,
344	,
345	,
346	,
347	,
348	,
349	,
350	,
351	,
352	,
353	,
354	,
355	,
356	,
357	,
358	,
359	,
360	,
361	,
362	,
363	,
364	,
365	,
366	,
367	,
368	,
369	,
370	,
371	,
372	,
373	,
374	,
375	,
376	,
377	,
378	,
379	,
380	,
381	,
382	,
383	,
384	,
385	,
386	,
387	,
388	,
389	,
390	,
391	,
392	,
393	,
394	,
395	,
396	,
397	,
398	,
399	,
400	,
401	,
402	,
403	,
403	,
404	,
405	,
405	,
406	,
407	,
407	,
408	,
409	,
409	,
410	,
411	,
411	,
412	,
413	,
413	,
414	,
415	,
415	,
416	,
417	,
417	,
418	,
419	,
419	,
420	,
420	,
421	,
422	,
422	,
423	,
424	,
424	,
425	,
426	,
426	,
427	,
428	,
428	,
429	,
430	,
430	,
431	,
432	,
432	,
433	,
434	,
434	,
435	,
436	,
436	,
437	,
438	,
438	,
439	,
440	,
440	,
441	,
442	,
442	,
443	,
444	,
444	,
445	,
446	,
446	,
447	,
448	,
448	,
449	,
450	,
450	,
451	,
452	,
452	,
453	,
454	,
454	,
455	,
455	,
456	,
457	,
457	,
458	,
459	,
459	,
460	,
461	,
461	,
462	,
463	,
463	,
464	,
465	,
465	,
466	,
467	,
467	,
468	,
469	,
469	,
470	,
471	,
471	,
472	,
473	,
473	,
474	,
475	,
475	,
476	,
477	,
477	,
478	,
479	,
479	,
480	,
481	,
481	,
482	,
483	,
483	,
484	,
485	,
485	,
486	,
487	,
487	,
488	,
489	,
489	,
490	,
490	,
491	,
492	,
492	,
493	,
494	,
494	,
495	,
496	,
496	,
497	,
498	,
498	,
499	,
500	
};


uint16 aqi_table_customer[5] = {12, 35, 55, 150, 250};

void get_aqi_value(uint16 PM_val, uint16 *AQI_val,uint8 *AQI_level)
{
	PM_val /=10;
	if(PM_val < AQI_INDEX_RNG) 
	{
		if(pm25_sensor.AQI_area == 1)
			*AQI_val = aqi_table_china[PM_val];
		else if(pm25_sensor.AQI_area == 2)
		{
			if(PM_val<aqi_table_customer[0])
			{
				*AQI_val = ((500/12) * PM_val) /10;
			}
			else if(PM_val<aqi_table_customer[1])
			{
				*AQI_val = (((PM_val-aqi_table_customer[0])*500)/(aqi_table_customer[1]-aqi_table_customer[0]))/10+50;
			}
			else if(PM_val<aqi_table_customer[2])
			{
				*AQI_val = (((PM_val-aqi_table_customer[1])*500)/(aqi_table_customer[2]-aqi_table_customer[1]))/10+100;
			}
			else if(PM_val<aqi_table_customer[3])
			{
				*AQI_val = (((PM_val-aqi_table_customer[2])*500)/(aqi_table_customer[3]-aqi_table_customer[2]))/10+150;
			}
			else if(PM_val<aqi_table_customer[4])
			{
				*AQI_val = (((PM_val-aqi_table_customer[3])*500)/(aqi_table_customer[4]-aqi_table_customer[3]))/10+200;
			}
			else
			{
				*AQI_val = (((PM_val-aqi_table_customer[4])*500)/(500-aqi_table_customer[4]))/10+300;
			}
		}
		else
			*AQI_val = aqi_table_usa[PM_val];
	}
	else 
		*AQI_val = PM_val;
	
	if(*AQI_val < LEVEL0) *AQI_level = GOOD;
	else if(*AQI_val < LEVEL1) *AQI_level = MODERATE;
	else if(*AQI_val < LEVEL2 ) *AQI_level = POOL_FOR_SOME;
	else if(*AQI_val < LEVEL3 ) *AQI_level = UNHEALTHY;
	else if(*AQI_val < LEVEL4) *AQI_level = MORE_UNHEALTHY;
	else   *AQI_level = HAZARDOUS; 

}
